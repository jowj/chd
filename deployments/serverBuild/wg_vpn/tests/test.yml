---
- hosts: vpn
  roles:
  - wg_vpn

  tasks:
    - name: Verify remote wg node has wg running
      shell: ping -c1 10.200.219.1
      register: remote_result
    - assert:
        that:
          - "'1 packets transmitted, 1 packets received' in remote_result.stdout"

    - name: Verify remote wg node has wg running
      shell: ping -c1 10.200.219.2
      register: local_result
    - assert:
        that:
          - "'1 packets transmitted, 1 packets received' in local_result.stdout"      
    - name: Verify that local node can talk to remote
      shell: ping -c1 10.200.219.1
      register: tunnel_result
    - assert:
        that:
          - "'1 packets transmitted, 1 packets received' in tunnel_result.stdout"      
